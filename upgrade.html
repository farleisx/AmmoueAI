<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upgrade to Pro | Ammoue</title>
<link rel="icon" type="image/png" href="Gemini_Generated_Image_qry9pfqry9pfqry9.png">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .text-ammoue { color: #0d9488; }
    .bg-ammoue { background-color: #0d9488; }
</style>
</head>

<body class="antialiased min-h-screen flex flex-col items-center justify-center">

<div class="max-w-md w-full p-8 bg-white border border-gray-200 rounded-2xl shadow-xl text-center">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">
        Upgrade to <span class="text-ammoue">Pro</span>
    </h1>

    <p class="text-gray-700 mb-6">Pay once â€” get lifetime PRO access! ðŸ”¥</p>

    <!-- PAYPAL BUTTON HERE -->
    <div id="paypal-button-container"></div>

    <!-- STATUS -->
    <p id="status-message" class="mt-4 text-gray-600 font-medium"></p>
</div>


<!-- PAYPAL SDK (IMPORTANT: Insert your Client ID) -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID_HERE&currency=USD"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";


// ðŸ”¥ Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAmnZ69YDcEFcmuXIhmGxDUSPULxpI-Bmg",
    authDomain: "ammoueai.firebaseapp.com",
    projectId: "ammoueai",
    storageBucket: "ammoueai.firebasestorage.app",
    messagingSenderId: "135818868149",
    appId: "1:135818868149:web:db9280baf9540a3339d5fc",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
const statusMessage = document.getElementById("status-message");

// Update Firestore Plan
async function setPlanToPro(uid) {
    await setDoc(doc(db, "users", uid), { plan: "pro" }, { merge: true });
    statusMessage.textContent = "Payment complete! Upgrading your planâ€¦ ðŸš€";

    setTimeout(() => {
        window.location.href = "dashboard.html";
    }, 1500);
}

// Monitor User Login
onAuthStateChanged(auth, (user) => {
    currentUser = user;
    if (!user) {
        statusMessage.textContent = "Please login to upgrade your plan.";
    }
});

// PayPal Smart Buttons
paypal.Buttons({
    createOrder: () => {
        return fetch("/api/paypal-order", {
            method: "POST"
        })
        .then(res => res.json())
        .then(data => data.orderID)
    },

    onApprove: (data) => {
        if (!currentUser) return statusMessage.textContent = "You must login first!";

        return fetch(`/api/paypal-capture?orderID=${data.orderID}`)
        .then(res => res.json())
        .then(async () => {
            await setPlanToPro(currentUser.uid);
        });
    },

    onError: () => {
        statusMessage.textContent = "Payment failed. Try again!";
    }
}).render("#paypal-button-container");

</script>

</body>
</html>
