<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="Gemini_Generated_Image_qry9pfqry9pfqry9.png">
<title>Upgrade to Pro | Ammoue</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .text-ammoue { color: #0d9488; }
    .bg-ammoue { background-color: #0d9488; }
    .text-error { color: #ef4444; }
</style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center justify-center gap-6">

<div class="max-w-md w-full p-8 bg-white border border-gray-200 rounded-2xl shadow-xl text-center">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Upgrade to <span class="text-ammoue">Pro</span></h1>

    <!-- Instructions -->
    <div id="instructions" class="mb-6 text-left">
        <h3 class="text-xl font-semibold mb-2">How to Pay</h3>
        <ol class="list-decimal list-inside text-gray-700 space-y-1">
            <li>Open your <strong>Phantom Wallet</strong> or another Solana wallet.</li>
            <li>Scan the QR code below, or copy the payment link.</li>
            <li>Send exactly <strong>$5</strong> worth of SOL.</li>
            <li>Include this reference code in your payment:</li>
            <pre id="reference-code" class="bg-gray-100 p-2 rounded text-sm">TEST1234567890</pre>
            <li>Once the payment is received, your plan will be upgraded automatically.</li>
        </ol>
    </div>

    <!-- QR code / Payment link -->
    <div id="crypto-qr" class="bg-gray-100 p-6 rounded-lg mb-4 text-center text-sm">
        [QR Code Placeholder]
    </div>

    <!-- Status -->
    <p id="status-message" class="mt-4 text-gray-600 font-medium">Waiting for payment...</p>

    <!-- Retry button -->
    <button id="retry-btn" class="mt-6 px-6 py-3 rounded-xl bg-ammoue text-white hover:bg-teal-700 transition">
        Retry Payment
    </button>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=USD"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAmnZ69YDcEFcmuXIhmGxDUSPULxpI-Bmg",
    authDomain: "ammoueai.firebaseapp.com",
    projectId: "ammoueai",
    storageBucket: "ammoueai.firebasestorage.app",
    messagingSenderId: "135818868149",
    appId: "1:135818868149:web:db9280baf9540a3339d5fc",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
const statusMessage = document.getElementById("status-message");

// Update Firestore plan
async function setPlanToPro(uid) {
    await setDoc(doc(db, "users", uid), { plan: "pro" }, { merge: true });
    statusMessage.textContent = "Payment complete! Upgradingâ€¦ ðŸš€";

    setTimeout(() => window.location.href = "dashboard.html", 1500);
}

onAuthStateChanged(auth, (user) => {
    currentUser = user;
    if (!user) {
        statusMessage.textContent = "You must log in first!";
    }
});

// PayPal Buttons Setup
paypal.Buttons({
    createOrder: () => {
        return fetch("/api/paypal-order.php", {
            method: "POST"
        }).then(res => res.json()).then(data => data.orderID);
    },
    onApprove: (data) => {
        if (!currentUser) {
            statusMessage.textContent = "Login required!";
            return;
        }
        return fetch(`/api/paypal-capture.php?orderID=${data.orderID}`)
        .then(res => res.json())
        .then(async () => {
            await setPlanToPro(currentUser.uid);
        });
    },
    onError: () => {
        statusMessage.textContent = "Payment error. Try again.";
    }
}).render("#paypal-button-container");
</script>
</body>
</html>
